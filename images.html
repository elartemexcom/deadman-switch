<script>
  const gallery = document.getElementById("gallery");

  const MAX_N = 82;
  const EXTS = ["jpg", "jpeg", "png"];

  function tryLoad(src) {
    return new Promise(resolve => {
      const img = new Image();
      img.loading = "lazy";
      img.decoding = "async";
      img.onload = () => resolve(img);
      img.onerror = () => resolve(null);
      img.src = src;
    });
  }

  async function loadIndex(n) {
    const base = (n === 0) ? "img" : `img (${n})`;

    for (const ext of EXTS) {
      const file = `${base}.${ext}`;
      const src = `images/${encodeURIComponent(file)}`;

      const img = await tryLoad(src);
      if (img) {
        const fig = document.createElement("figure");
        fig.appendChild(img);

        const cap = document.createElement("figcaption");
        cap.textContent = file;
        fig.appendChild(cap);

        gallery.appendChild(fig);
        // ⚠️ no return — keep going
      }
    }
  }

  (async () => {
    await loadIndex(0);
    for (let i = 1; i <= MAX_N; i++) {
      await loadIndex(i);
    }
  })();
</script>
