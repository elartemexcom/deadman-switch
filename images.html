<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>archive</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{margin:0;padding:40px 20px;background:#f4f0e6;color:#2a2a2a;font-family:Georgia,"Times New Roman",serif;}
    .wrap{max-width:980px;margin:0 auto;}
    h1{text-align:center;font-weight:normal;letter-spacing:1px;margin:0 0 8px 0;}
    .sub{text-align:center;font-size:13px;color:#7a6f5a;margin:0 0 44px 0;}
    .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:26px;}
    figure{margin:0;background:#fff;padding:8px;border:1px solid #cfc6b4;box-shadow:0 4px 12px rgba(0,0,0,0.08);}
    img{width:100%;height:auto;display:block;}
    figcaption{margin-top:8px;font-size:12px;color:#8b7f67;word-break:break-word;}
    footer{margin-top:64px;text-align:center;font-size:12px;color:#8b7f67;}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>archive</h1>
    <p class="sub">no feed · no sorting · only finding</p>

    <div id="gallery" class="gallery"></div>

    <footer>./images</footer>
  </div>

  <script>
    const gallery = document.getElementById("gallery");
    const MAX_N = 82;
    const EXTS = ["jpg","jpeg","png"];

    function encodePath(p){
      // encodes each segment safely (spaces, parentheses)
      return p.split("/").map(encodeURIComponent).join("/");
    }

    function tryLoad(url) {
      return new Promise(resolve => {
        const img = new Image();
        img.loading = "lazy";
        img.decoding = "async";
        img.onload = () => resolve(img);
        img.onerror = () => resolve(null);
        img.src = url;
      });
    }

    async function add(file) {
      const url = encodePath(`./images/${file}`);
      const img = await tryLoad(url);
      if (!img) return false;

      const fig = document.createElement("figure");
      const cap = document.createElement("figcaption");
      cap.textContent = file;

      fig.appendChild(img);
      fig.appendChild(cap);
      gallery.appendChild(fig);
      return true;
    }

    function bases(n){
      if (n === 0) return ["img"];
      return [`img (${n})`, `img(${n})`]; // handles both spacing styles
    }

    (async () => {
      // Also prints helpful info
      console.log("Gallery starting. Looking in ./images/");

      for (let n = 0; n <= MAX_N; n++) {
        for (const b of bases(n)) {
          for (const ext of EXTS) {
            await add(`${b}.${ext}`);
          }
        }
      }

      console.log("Gallery finished.");
    })();
  </script>
</body>
</html>
